{"updatedAt":"2025-11-12T00:57:08.979Z","createdAt":"2025-10-07T15:41:12.400Z","id":"aVG6LC4ZFRMN7Bw6","name":"SAM Master Campaign Orchestrator","active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"campaign-execute","options":{"rawBody":false}},"id":"1a2a33ee-4d66-45bd-828d-1de5a67cc723","name":"Campaign Execute Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-5504,-592],"webhookId":"campaign-execute"},{"parameters":{"functionCode":"// Extract and flatten prospect data for processing\ntry {\n  const inputData = $input.first().json;\n  const webhookData = inputData.body || inputData;\n\n  console.log('=== CAMPAIGN HANDLER DEBUG ===');\n  console.log('Full webhook data:', JSON.stringify(webhookData, null, 2));\n\n  // Get unipileAccountId - handle both object and string formats\n  let unipileAccountId;\n  if (typeof webhookData.unipileAccountId === 'object' && webhookData.unipileAccountId !== null) {\n    unipileAccountId = webhookData.unipileAccountId.unipile_account_id;\n    console.log('Extracted unipileAccountId from object:', unipileAccountId);\n  } else {\n    unipileAccountId = webhookData.unipileAccountId;\n    console.log('Using direct unipileAccountId:', unipileAccountId);\n  }\n\n  // CRITICAL: Validate unipileAccountId exists\n  if (!unipileAccountId) {\n    console.error('ERROR: unipileAccountId is missing or undefined!');\n    console.error('webhookData.unipileAccountId:', webhookData.unipileAccountId);\n    throw new Error('unipileAccountId is required but was not provided in webhook payload');\n  }\n\n  console.log('Final unipileAccountId:', unipileAccountId);\n\n  // Process each prospect and create individual items\n  const prospects = webhookData.prospects || [];\n  console.log(`Processing ${prospects.length} prospects`);\n\n  const result = prospects.map((prospect, index) => {\n    // Ensure unipile_dsn has protocol prefix\n    let unipileDsn = webhookData.unipile_dsn || '';\n    if (unipileDsn && !unipileDsn.startsWith('http://') && !unipileDsn.startsWith('https://')) {\n      unipileDsn = 'https://' + unipileDsn;\n    }\n\n    const item = {\n      workspace_id: webhookData.workspaceId || webhookData.workspace_id,\n      campaign_id: webhookData.campaignId || webhookData.campaign_id,\n      unipile_account_id: unipileAccountId,\n      unipile_dsn: unipileDsn,\n      unipile_api_key: webhookData.unipile_api_key,\n      supabase_url: webhookData.supabase_url,\n      supabase_service_key: webhookData.supabase_service_key,\n      prospect: prospect,\n      linkedin_url: prospect.linkedin_url,\n      linkedin_username: prospect.linkedin_url ? prospect.linkedin_url.split('/in/')[1]?.replace(/\\/$/, '') : null,\n      provider_id: null,\n      messages: webhookData.messages || {},\n      timing: webhookData.timing || {\n        fu1_delay_days: 2,\n        fu2_delay_days: 5,\n        fu3_delay_days: 7,\n        fu4_delay_days: 5,\n        gb_delay_days: 7\n      },\n      send_delay_minutes: prospect.send_delay_minutes || 0,\n      last_message_sent: new Date().toISOString()\n    };\n\n    if (index === 0) {\n      console.log('Sample item output:', JSON.stringify(item, null, 2));\n    }\n\n    return item;\n  });\n\n  console.log('=== END CAMPAIGN HANDLER DEBUG ===');\n  return result;\n\n} catch (error) {\n  console.error('Error in Campaign Handler:', error.message);\n  console.error('Error stack:', error.stack);\n  throw error;\n}\n"},"id":"f35ceeac-ac95-45fe-b68a-891ed84595d7","name":"Campaign Handler","type":"n8n-nodes-base.function","typeVersion":1,"position":[-5296,-592]},{"parameters":{"url":"={{ $json.unipile_dsn }}/api/v1/users/{{ $json.linkedin_username }}?account_id={{ $json.unipile_account_id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"},{"name":"Accept","value":"application/json"}]},"options":{}},"id":"8802605b-a30a-4564-a13b-e54b6a2af2da","name":"Get LinkedIn Profile","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-5088,-592]},{"parameters":{"functionCode":"// Merge profile data with original prospect data\nconst profileData = $input.first().json;\nconst originalData = $node['Campaign Handler'].json;\n\n// Merge: keep all original fields and add provider_id from profile\nreturn {\n  ...originalData,\n  provider_id: profileData.provider_id,\n  profile_name: profileData.name,\n  is_connected: profileData.is_connected || false\n};"},"id":"f7f16067-d8bf-466f-aeab-998f59f5a72f","name":"Merge Profile Data","type":"n8n-nodes-base.function","typeVersion":1,"position":[-4896,-592]},{"parameters":{"method":"POST","url":"={{ $json.unipile_dsn }}/api/v1/users/invite","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"},{"name":"Content-Type","value":"application/json"},{"name":"Accept","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"provider_id","value":"={{ $json.provider_id }}"},{"name":"account_id","value":"={{ $json.unipile_account_id }}"},{"name":"message","value":"={{ ($json.messages.cr || $json.messages.connection_request || '').replace('{first_name}', $json.prospect.first_name).replace('{last_name}', $json.prospect.last_name).replace('{company_name}', $json.prospect.company_name || '').replace('{title}', $json.prospect.title || '') }}"}]},"options":{}},"id":"06290791-d97f-4ce5-be3d-f403dc4aee30","name":"Send CR","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-4768,-880]},{"parameters":{"functionCode":"// Initialize connection check counter\nconst data = $input.first().json;\nreturn {\n  ...data,\n  connection_check_count: 0,\n  connection_check_start: new Date().toISOString()\n};"},"id":"ca876405-e939-4443-b173-304ccc8edf2f","name":"Init Connection Check","type":"n8n-nodes-base.function","typeVersion":1,"position":[-4512,-880]},{"parameters":{},"id":"02299aab-f706-4476-9b69-63f77ae2d5ab","name":"Wait 1 Hour","type":"n8n-nodes-base.wait","typeVersion":1,"position":[-4224,-880],"webhookId":"wait-connection-check-1hr"},{"parameters":{"functionCode":"// Restore data after wait\nconst originalData = $node['Init Connection Check'].json;\nreturn originalData;"},"id":"7d9c1bc5-5937-490e-822e-820d1ba4faf7","name":"Restore After Wait","type":"n8n-nodes-base.function","typeVersion":1,"position":[-4544,-592]},{"parameters":{"url":"={{ $json.unipile_dsn }}/api/v1/users/{{ $json.linkedin_username }}?account_id={{ $json.unipile_account_id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"}]},"options":{}},"id":"3e3f8eeb-17ad-493a-9634-2d1b27c5303d","name":"Check Connection Accepted","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-4288,-592]},{"parameters":{"conditions":{"options":{"caseSensitive":true},"conditions":[{"leftValue":"={{ $json.is_connected }}","rightValue":"true","operator":{"type":"boolean","operation":"equals"}}]},"options":{}},"id":"67ea0db7-d269-470d-beb9-dbf1faf4ce48","name":"Connection Accepted?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-4032,-592]},{"parameters":{"functionCode":"// Increment check counter and decide if we should keep checking\nconst data = $input.first().json;\nconst checkCount = (data.connection_check_count || 0) + 1;\nconst startTime = new Date(data.connection_check_start || new Date());\nconst now = new Date();\nconst hoursPassed = (now - startTime) / (1000 * 60 * 60);\n\n// Max 3 weeks (21 days = 504 hours) of checking\nconst maxHours = 504;\nconst shouldContinueChecking = hoursPassed < maxHours;\n\nreturn {\n  ...data,\n  connection_check_count: checkCount,\n  should_continue_checking: shouldContinueChecking,\n  hours_passed: Math.floor(hoursPassed)\n};"},"id":"73dbeff5-668c-4bd9-b660-776e30ca3627","name":"Increment Check Counter","type":"n8n-nodes-base.function","typeVersion":1,"position":[-3872,-864]},{"parameters":{"conditions":{"options":{},"conditions":[{"leftValue":"={{ $json.should_continue_checking }}","rightValue":"true","operator":{"type":"boolean","operation":"equals"}}]},"options":{}},"id":"7d817452-7f01-44fb-94ad-29609e97cbc7","name":"Should Retry Check?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-3680,-848]},{"parameters":{"method":"POST","url":"https://workflows.innovareai.com/webhook/wait-connection-check-1hr","sendBody":true,"bodyParameters":{"parameters":[{"name":"resumeData","value":"={{ JSON.stringify($json) }}"}]},"options":{}},"id":"04b93c86-b537-4e90-b574-e90e9064afdd","name":"Loop Back to Wait","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-3248,-880]},{"parameters":{"method":"POST","url":"https://app.meet-sam.com/api/webhooks/n8n/prospect-status","sendBody":true,"bodyParameters":{"parameters":[{"name":"prospect_id","value":"={{ $json.prospect.id }}"},{"name":"campaign_id","value":"={{ $json.campaign_id }}"},{"name":"status","value":"not_connected"}]},"options":{}},"id":"c6881350-9ee5-49a5-bfbb-b901c04b4c09","name":"Not Connected - Exit","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-3264,-624]},{"parameters":{"amount":4},"id":"a95d323e-1ab1-4a81-8411-5619b35a0ac8","name":"Wait 4 Hours After Acceptance","type":"n8n-nodes-base.wait","typeVersion":1,"position":[-4080,-256],"webhookId":"wait-after-acceptance"},{"parameters":{"functionCode":"// Restore data after acceptance wait\nconst originalData = $node['Check Connection Accepted'].json;\nreturn originalData;"},"id":"06834dec-ea36-4fd7-accf-77dc2c9be80a","name":"Restore After Acceptance Wait","type":"n8n-nodes-base.function","typeVersion":1,"position":[-3792,-256]},{"parameters":{"method":"POST","url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"attendees_ids","value":"={{ [$json.provider_id] }}"},{"name":"account_id","value":"={{ $json.unipile_account_id }}"},{"name":"text","value":"={{ $json.messages.acceptance_message ? $json.messages.acceptance_message.replace('{first_name}', $json.prospect.first_name).replace('{last_name}', $json.prospect.last_name) : 'Thanks for connecting, ' + $json.prospect.first_name + '!' }}"}]},"options":{}},"id":"5799fb79-af88-4b50-b5ab-bfd029442777","name":"Send Acceptance Message","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-3552,-256]},{"parameters":{"amount":"={{ $json.timing.fu1_delay_days }}","unit":"days"},"id":"f72b6acb-f4c1-48c8-8034-40c175c94327","name":"Wait FU1 Delay","type":"n8n-nodes-base.wait","typeVersion":1,"position":[-3328,-256],"webhookId":"wait-fu1-delay"},{"parameters":{"functionCode":"// Restore data after FU1 wait\nconst originalData = $node['Send Acceptance Message'].json;\nreturn originalData;"},"id":"130cedcd-00a0-47ab-87a8-a9f65e2cc7ea","name":"Restore After FU1 Wait","type":"n8n-nodes-base.function","typeVersion":1,"position":[-4080,64]},{"parameters":{"url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages?attendees_ids={{ $json.provider_id }}&account_id={{ $json.unipile_account_id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"}]},"options":{}},"id":"38f3370f-61ff-4e8a-9072-3364360a31b3","name":"Check Reply FU1","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-3856,64]},{"parameters":{"conditions":{"options":{},"conditions":[{"leftValue":"={{ $json.items?.filter(m => m.from !== $json.unipile_account_id && new Date(m.date) > new Date($json.last_message_sent)).length || 0 }}","rightValue":"0","operator":{"type":"number","operation":"equals"}}]},"options":{}},"id":"ab9a2f9f-2d9f-408f-86c1-dfe7ca57dfa1","name":"Reply Received FU1?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-3648,64]},{"parameters":{"method":"POST","url":"https://app.meet-sam.com/api/webhooks/n8n/prospect-status","sendBody":true,"bodyParameters":{"parameters":[{"name":"prospect_id","value":"={{ $json.prospect.id }}"},{"name":"campaign_id","value":"={{ $json.campaign_id }}"},{"name":"status","value":"replied"}]},"options":{}},"id":"75aa73da-3fcc-4ac8-bd7a-9c02681a10e4","name":"Mark Replied - Exit FU1","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-3376,320]},{"parameters":{"method":"POST","url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"attendees_ids","value":"={{ [$json.provider_id] }}"},{"name":"account_id","value":"={{ $json.unipile_account_id }}"},{"name":"text","value":"={{ $json.messages.follow_up_1.replace('{first_name}', $json.prospect.first_name).replace('{last_name}', $json.prospect.last_name).replace('{company_name}', $json.prospect.company_name).replace('{title}', $json.prospect.title) }}"}]},"options":{}},"id":"30a3ccb8-e7a0-483a-bf8f-6c0d29204ad6","name":"Send FU1","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-3392,48]},{"parameters":{"amount":"={{ $json.timing.fu2_delay_days }}","unit":"days"},"id":"92174a99-6cc2-4f28-a641-4588fbdb2343","name":"Wait for FU2","type":"n8n-nodes-base.wait","typeVersion":1,"position":[-3200,48],"webhookId":"wait-fu2"},{"parameters":{"url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages?attendees_ids={{ $json.provider_id }}&account_id={{ $json.unipile_account_id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"}]},"options":{}},"id":"128bc264-006a-406d-96b1-8ca08de61439","name":"Check Reply FU2","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-2896,-432]},{"parameters":{"conditions":{"options":{},"conditions":[{"leftValue":"={{ $json.items?.filter(m => m.from !== $json.unipile_account_id && new Date(m.date) > new Date($json.last_message_sent)).length || 0 }}","rightValue":"0","operator":{"type":"number","operation":"equals"}}]},"options":{}},"id":"d7f5637d-10ff-4088-a1d0-b766f2407550","name":"Reply Received FU2?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-2704,-432]},{"parameters":{"method":"POST","url":"https://app.meet-sam.com/api/webhooks/n8n/prospect-status","sendBody":true,"bodyParameters":{"parameters":[{"name":"prospect_id","value":"={{ $json.prospect.id }}"},{"name":"campaign_id","value":"={{ $json.campaign_id }}"},{"name":"status","value":"replied"}]},"options":{}},"id":"f4949850-c2ce-4951-9e14-8ecfdf447223","name":"Mark Replied - Exit FU2","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-2512,-528]},{"parameters":{"method":"POST","url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"attendees_ids","value":"={{ [$json.provider_id] }}"},{"name":"account_id","value":"={{ $json.unipile_account_id }}"},{"name":"text","value":"={{ $json.messages.follow_up_2.replace('{first_name}', $json.prospect.first_name).replace('{last_name}', $json.prospect.last_name).replace('{company_name}', $json.prospect.company_name).replace('{title}', $json.prospect.title) }}"}]},"options":{}},"id":"4d2bb977-6424-4d43-8b65-454b86ff8560","name":"Send FU2","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-2512,-320]},{"parameters":{"amount":"={{ $json.timing.fu3_delay_days }}","unit":"days"},"id":"3a55742c-5c3a-41e5-a948-ca003c0f181e","name":"Wait for FU3","type":"n8n-nodes-base.wait","typeVersion":1,"position":[-2320,-320],"webhookId":"wait-fu3"},{"parameters":{"url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages?attendees_ids={{ $json.provider_id }}&account_id={{ $json.unipile_account_id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"}]},"options":{}},"id":"2080310e-e138-418e-98fe-7c9a5c45c47d","name":"Check Reply FU3","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-2128,-320]},{"parameters":{"conditions":{"options":{},"conditions":[{"leftValue":"={{ $json.items?.filter(m => m.from !== $json.unipile_account_id && new Date(m.date) > new Date($json.last_message_sent)).length || 0 }}","rightValue":"0","operator":{"type":"number","operation":"equals"}}]},"options":{}},"id":"73701908-8a08-4175-b23d-0c2462911468","name":"Reply Received FU3?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-1936,-320]},{"parameters":{"method":"POST","url":"https://app.meet-sam.com/api/webhooks/n8n/prospect-status","sendBody":true,"bodyParameters":{"parameters":[{"name":"prospect_id","value":"={{ $json.prospect.id }}"},{"name":"campaign_id","value":"={{ $json.campaign_id }}"},{"name":"status","value":"replied"}]},"options":{}},"id":"62da5948-1946-4029-972b-6037663847d0","name":"Mark Replied - Exit FU3","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-1744,-432]},{"parameters":{"method":"POST","url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"attendees_ids","value":"={{ [$json.provider_id] }}"},{"name":"account_id","value":"={{ $json.unipile_account_id }}"},{"name":"text","value":"={{ $json.messages.follow_up_3.replace('{first_name}', $json.prospect.first_name).replace('{last_name}', $json.prospect.last_name).replace('{company_name}', $json.prospect.company_name).replace('{title}', $json.prospect.title) }}"}]},"options":{}},"id":"36c01387-62a0-4974-a4bc-590e078f185c","name":"Send FU3","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-1744,-224]},{"parameters":{"amount":"={{ $json.timing.fu4_delay_days }}","unit":"days"},"id":"237accc4-5cf7-46db-8ef5-9d72fe85ab4c","name":"Wait for FU4","type":"n8n-nodes-base.wait","typeVersion":1,"position":[-1552,-224],"webhookId":"wait-fu4"},{"parameters":{"url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages?attendees_ids={{ $json.provider_id }}&account_id={{ $json.unipile_account_id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"}]},"options":{}},"id":"50aca342-ebbc-49ae-870d-91448aca0f91","name":"Check Reply FU4","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-1360,-224]},{"parameters":{"conditions":{"options":{},"conditions":[{"leftValue":"={{ $json.items?.filter(m => m.from !== $json.unipile_account_id && new Date(m.date) > new Date($json.last_message_sent)).length || 0 }}","rightValue":"0","operator":{"type":"number","operation":"equals"}}]},"options":{}},"id":"5a7c3579-0b11-4882-80d4-20eb2248358a","name":"Reply Received FU4?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-1168,-224]},{"parameters":{"method":"POST","url":"https://app.meet-sam.com/api/webhooks/n8n/prospect-status","sendBody":true,"bodyParameters":{"parameters":[{"name":"prospect_id","value":"={{ $json.prospect.id }}"},{"name":"campaign_id","value":"={{ $json.campaign_id }}"},{"name":"status","value":"replied"}]},"options":{}},"id":"f8170ca4-4581-4fbc-8645-34646b058b18","name":"Mark Replied - Exit FU4","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-976,-320]},{"parameters":{"method":"POST","url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"attendees_ids","value":"={{ [$json.provider_id] }}"},{"name":"account_id","value":"={{ $json.unipile_account_id }}"},{"name":"text","value":"={{ $json.messages.follow_up_4.replace('{first_name}', $json.prospect.first_name).replace('{last_name}', $json.prospect.last_name).replace('{company_name}', $json.prospect.company_name).replace('{title}', $json.prospect.title) }}"}]},"options":{}},"id":"0a49361c-eae8-4a4b-bca8-dd498ed6ee3e","name":"Send FU4","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-976,-128]},{"parameters":{"amount":"={{ $json.timing.gb_delay_days }}","unit":"days"},"id":"75566686-cd23-47ad-ae0e-7494b14c76b2","name":"Wait for GB","type":"n8n-nodes-base.wait","typeVersion":1,"position":[-784,-128],"webhookId":"wait-gb"},{"parameters":{"url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages?attendees_ids={{ $json.provider_id }}&account_id={{ $json.unipile_account_id }}","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"}]},"options":{}},"id":"8072b836-c973-406d-8266-bcbbaaf51355","name":"Check Reply GB","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-592,-128]},{"parameters":{"conditions":{"options":{},"conditions":[{"leftValue":"={{ $json.items?.filter(m => m.from !== $json.unipile_account_id && new Date(m.date) > new Date($json.last_message_sent)).length || 0 }}","rightValue":"0","operator":{"type":"number","operation":"equals"}}]},"options":{}},"id":"a8e5f53e-8000-4751-9e1e-7737a187670a","name":"Reply Received GB?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-400,-128]},{"parameters":{"method":"POST","url":"https://app.meet-sam.com/api/webhooks/n8n/prospect-status","sendBody":true,"bodyParameters":{"parameters":[{"name":"prospect_id","value":"={{ $json.prospect.id }}"},{"name":"campaign_id","value":"={{ $json.campaign_id }}"},{"name":"status","value":"replied"}]},"options":{}},"id":"0d293f38-5c67-4115-b24f-9b1c733d05d7","name":"Mark Replied - Exit GB","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-208,-224]},{"parameters":{"method":"POST","url":"={{ $json.unipile_dsn }}/api/v1/messaging/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-API-KEY","value":"={{ $json.unipile_api_key }}"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"attendees_ids","value":"={{ [$json.provider_id] }}"},{"name":"account_id","value":"={{ $json.unipile_account_id }}"},{"name":"text","value":"={{ $json.messages.goodbye.replace('{first_name}', $json.prospect.first_name).replace('{last_name}', $json.prospect.last_name).replace('{company_name}', $json.prospect.company_name).replace('{title}', $json.prospect.title) }}"}]},"options":{}},"id":"5deaaedd-ce9e-477a-b9a5-ca89fa8b5454","name":"Send GB (Breakup)","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-208,-32]},{"parameters":{"method":"POST","url":"https://app.meet-sam.com/api/webhooks/n8n/prospect-status","sendBody":true,"bodyParameters":{"parameters":[{"name":"prospect_id","value":"={{ $json.prospect.id }}"},{"name":"campaign_id","value":"={{ $json.campaign_id }}"},{"name":"status","value":"completed_no_reply"}]},"options":{}},"id":"215ce3fc-8e79-4164-ba08-6d2074e886a6","name":"Mark Campaign Complete","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-16,-32]},{"parameters":{"amount":"={{ $json.send_delay_minutes || 0 }}","unit":"minutes"},"id":"832778a6-ad69-43ef-8906-cbbad3a95333","name":"Wait for Cadence Delay","type":"n8n-nodes-base.wait","typeVersion":1,"position":[-4864,-592],"webhookId":"wait-cadence-delay"},{"parameters":{"method":"POST","url":"https://app.meet-sam.com/api/webhooks/n8n/prospect-status","sendBody":true,"bodyParameters":{"parameters":[{"name":"prospect_id","value":"={{ $json.prospect.id }}"},{"name":"campaign_id","value":"={{ $json.campaign_id }}"},{"name":"status","value":"connection_requested"}]},"options":{}},"id":"b345f2b9-80b4-44df-974a-6b0478f21c14","name":"Update Status - CR Sent","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-4672,-592]}],"connections":{"webhook_trigger":{"main":[[{"node":"campaign_handler","type":"main","index":0}]]},"workspace_router":{"main":[[{"node":"template_selector","type":"main","index":0}]]},"template_selector":{"main":[[{"node":"campaign_handler","type":"main","index":0}]]},"campaign_handler":{"main":[[{"node":"prospect_loop","type":"main","index":0}]]},"prospect_loop":{"main":[[{"node":"send_cr","type":"main","index":0}]]},"send_cr":{"main":[[{"node":"check_connection_accepted","type":"main","index":0}]]},"check_connection_accepted":{"main":[[{"node":"if_connection_accepted","type":"main","index":0}]]},"if_connection_accepted":{"main":[[{"node":"mark_not_connected","type":"main","index":0}],[{"node":"wait_fu1","type":"main","index":0}]]},"wait_fu1":{"main":[[{"node":"check_reply_fu1","type":"main","index":0}]]},"check_reply_fu1":{"main":[[{"node":"if_reply_fu1","type":"main","index":0}]]},"if_reply_fu1":{"main":[[{"node":"mark_engaged_fu1","type":"main","index":0}],[{"node":"send_fu1","type":"main","index":0}]]},"send_fu1":{"main":[[{"node":"wait_fu2","type":"main","index":0}]]},"wait_fu2":{"main":[[{"node":"check_reply_fu2","type":"main","index":0}]]},"check_reply_fu2":{"main":[[{"node":"if_reply_fu2","type":"main","index":0}]]},"if_reply_fu2":{"main":[[{"node":"mark_engaged_fu2","type":"main","index":0}],[{"node":"send_fu2","type":"main","index":0}]]},"send_fu2":{"main":[[{"node":"wait_fu3","type":"main","index":0}]]},"wait_fu3":{"main":[[{"node":"check_reply_fu3","type":"main","index":0}]]},"check_reply_fu3":{"main":[[{"node":"if_reply_fu3","type":"main","index":0}]]},"if_reply_fu3":{"main":[[{"node":"mark_engaged_fu3","type":"main","index":0}],[{"node":"send_fu3","type":"main","index":0}]]},"send_fu3":{"main":[[{"node":"wait_fu4","type":"main","index":0}]]},"wait_fu4":{"main":[[{"node":"check_reply_fu4","type":"main","index":0}]]},"check_reply_fu4":{"main":[[{"node":"if_reply_fu4","type":"main","index":0}]]},"if_reply_fu4":{"main":[[{"node":"mark_engaged_fu4","type":"main","index":0}],[{"node":"send_fu4","type":"main","index":0}]]},"send_fu4":{"main":[[{"node":"wait_gb","type":"main","index":0}]]},"wait_gb":{"main":[[{"node":"check_reply_gb","type":"main","index":0}]]},"check_reply_gb":{"main":[[{"node":"if_reply_gb","type":"main","index":0}]]},"if_reply_gb":{"main":[[{"node":"mark_engaged_gb","type":"main","index":0}],[{"node":"send_gb","type":"main","index":0}]]},"send_gb":{"main":[[{"node":"update_status","type":"main","index":0}]]},"Campaign Execute Webhook":{"main":[[{"node":"Campaign Handler","type":"main","index":0}]]},"Campaign Handler":{"main":[[{"node":"Get LinkedIn Profile","type":"main","index":0}]]},"Get LinkedIn Profile":{"main":[[{"node":"Merge Profile Data","type":"main","index":0}]]},"Merge Profile Data":{"main":[[{"node":"Wait for Cadence Delay","type":"main","index":0}]]},"Send CR":{"main":[[{"node":"Update Status - CR Sent","type":"main","index":0}]]},"Init Connection Check":{"main":[[{"node":"Wait 1 Hour","type":"main","index":0}]]},"Wait 1 Hour":{"main":[[{"node":"Restore After Wait","type":"main","index":0}]]},"Restore After Wait":{"main":[[{"node":"Check Connection Accepted","type":"main","index":0}]]},"Check Connection Accepted":{"main":[[{"node":"Connection Accepted?","type":"main","index":0}]]},"Connection Accepted?":{"main":[[{"node":"Increment Check Counter","type":"main","index":0}],[{"node":"Wait 4 Hours After Acceptance","type":"main","index":0}]]},"Increment Check Counter":{"main":[[{"node":"Should Retry Check?","type":"main","index":0}]]},"Should Retry Check?":{"main":[[{"node":"Loop Back to Wait","type":"main","index":0}],[{"node":"Not Connected - Exit","type":"main","index":0}]]},"Wait 4 Hours After Acceptance":{"main":[[{"node":"Restore After Acceptance Wait","type":"main","index":0}]]},"Restore After Acceptance Wait":{"main":[[{"node":"Send Acceptance Message","type":"main","index":0}]]},"Send Acceptance Message":{"main":[[{"node":"Wait FU1 Delay","type":"main","index":0}]]},"Wait FU1 Delay":{"main":[[{"node":"Restore After FU1 Wait","type":"main","index":0}]]},"Restore After FU1 Wait":{"main":[[{"node":"Check Reply FU1","type":"main","index":0}]]},"Check Reply FU1":{"main":[[{"node":"Reply Received FU1?","type":"main","index":0}]]},"Reply Received FU1?":{"main":[[{"node":"Send FU1","type":"main","index":0}],[{"node":"Mark Replied - Exit FU1","type":"main","index":0}]]},"Send FU1":{"main":[[{"node":"Wait for FU2","type":"main","index":0}]]},"Wait for FU2":{"main":[[{"node":"Check Reply FU2","type":"main","index":0}]]},"Check Reply FU2":{"main":[[{"node":"Reply Received FU2?","type":"main","index":0}]]},"Reply Received FU2?":{"main":[[{"node":"Send FU2","type":"main","index":0}],[{"node":"Mark Replied - Exit FU2","type":"main","index":0}]]},"Send FU2":{"main":[[{"node":"Wait for FU3","type":"main","index":0}]]},"Wait for FU3":{"main":[[{"node":"Check Reply FU3","type":"main","index":0}]]},"Check Reply FU3":{"main":[[{"node":"Reply Received FU3?","type":"main","index":0}]]},"Reply Received FU3?":{"main":[[{"node":"Send FU3","type":"main","index":0}],[{"node":"Mark Replied - Exit FU3","type":"main","index":0}]]},"Send FU3":{"main":[[{"node":"Wait for FU4","type":"main","index":0}]]},"Wait for FU4":{"main":[[{"node":"Check Reply FU4","type":"main","index":0}]]},"Check Reply FU4":{"main":[[{"node":"Reply Received FU4?","type":"main","index":0}]]},"Reply Received FU4?":{"main":[[{"node":"Send FU4","type":"main","index":0}],[{"node":"Mark Replied - Exit FU4","type":"main","index":0}]]},"Send FU4":{"main":[[{"node":"Wait for GB","type":"main","index":0}]]},"Wait for GB":{"main":[[{"node":"Check Reply GB","type":"main","index":0}]]},"Check Reply GB":{"main":[[{"node":"Reply Received GB?","type":"main","index":0}]]},"Reply Received GB?":{"main":[[{"node":"Send GB (Breakup)","type":"main","index":0}],[{"node":"Mark Replied - Exit GB","type":"main","index":0}]]},"Send GB (Breakup)":{"main":[[{"node":"Mark Campaign Complete","type":"main","index":0}]]},"Wait for Cadence Delay":{"main":[[{"node":"Send CR","type":"main","index":0}]]},"Update Status - CR Sent":{"main":[[{"node":"Init Connection Check","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"America/New_York","saveManualExecutions":true,"saveExecutionProgress":true,"saveDataSuccessExecution":"all","saveDataErrorExecution":"all","executionTimeout":3600},"staticData":null,"meta":null,"pinData":{},"versionId":"598773e1-f9c6-4c85-a4c2-f3e7c2feac5b","versionCounter":37,"triggerCount":1,"shared":[{"updatedAt":"2025-10-07T15:41:12.406Z","createdAt":"2025-10-07T15:41:12.406Z","role":"workflow:owner","workflowId":"aVG6LC4ZFRMN7Bw6","projectId":"E9Xq0Sqn9jUGEbhJ","project":{"updatedAt":"2025-07-12T06:08:41.888Z","createdAt":"2025-07-12T06:02:59.801Z","id":"E9Xq0Sqn9jUGEbhJ","name":"Thorsten Linz <tl@innovareai.com>","type":"personal","icon":null,"description":null,"projectRelations":[{"updatedAt":"2025-07-12T06:02:59.801Z","createdAt":"2025-07-12T06:02:59.801Z","userId":"9c8841b7-d88f-4eac-afb9-77f989fc9916","projectId":"E9Xq0Sqn9jUGEbhJ","user":{"updatedAt":"2025-11-12T01:02:12.000Z","createdAt":"2025-07-12T06:02:58.862Z","id":"9c8841b7-d88f-4eac-afb9-77f989fc9916","email":"tl@innovareai.com","firstName":"Thorsten","lastName":"Linz","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-07-12T06:09:06.052Z","personalization_survey_n8n_version":"1.101.2","companySize":"<20","companyType":"saas","role":"business-owner","reportedSource":"google"},"settings":{"userActivated":true,"firstSuccessfulWorkflowId":"JHIOAOorkZSRmpA8","userActivatedAt":1752382374010,"easyAIWorkflowOnboarded":true,"npsSurvey":{"responded":true,"lastShownAt":1754499132724}},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2025-11-12","isPending":false}}]}}],"tags":[]}