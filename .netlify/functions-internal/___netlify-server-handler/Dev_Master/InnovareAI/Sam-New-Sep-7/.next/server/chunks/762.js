exports.id=762,exports.ids=[762],exports.modules={67310:(a,b,c)=>{"use strict";c.d(b,{g:()=>h});var d=c(82461);let e=process.env.SUPABASE_SERVICE_ROLE_KEY,f=(0,d.UU)("https://latxadqrvrrrcvkktrog.supabase.co",e,{auth:{autoRefreshToken:!1,persistSession:!1}});class g{async classifyConversation(a,b={}){try{let{data:c,error:d}=await f.rpc("classify_conversation_content",{conversation_text:a,user_context:b});if(d)return console.error("Error classifying conversation:",d),this.getFallbackClassification(a);return c}catch(b){return console.error("Classification error:",b),this.getFallbackClassification(a)}}async enhancedClassification(a,b,c={}){let d=`${a} ${b}`,e=await this.classifyConversation(d,c);return this.applyAdvancedPatterns(d,e,c)}applyAdvancedPatterns(a,b,c){let d=a.toLowerCase(),e={...b},f=this.detectCommunicationStyle(d);f.confidence>.5&&(e.personal_data.communication_style={...e.personal_data.communication_style,...f});let g=this.extractProfessionalContext(d);g.confidence>.6&&(e.personal_data.professional_context={...e.personal_data.professional_context,...g});let h=this.extractCustomerIntelligence(d);h.confidence>.5&&(e.team_shareable.customer_intelligence={...e.team_shareable.customer_intelligence,...h});let i=this.extractMarketInsights(d);i.confidence>.5&&(e.team_shareable.market_insights={...e.team_shareable.market_insights,...i});let j=this.extractCompetitiveIntelligence(d);j.confidence>.6&&(e.team_shareable.competitive_intelligence={...e.team_shareable.competitive_intelligence,...j});let k=Object.keys(e.personal_data).length,l=Object.keys(e.team_shareable).length;return e.classification_confidence=Math.min(.95,b.classification_confidence+(k+l)*.05),e}detectCommunicationStyle(a){let b={formal:{keywords:["please","thank you","appreciate","kindly","respectfully","sincerely"],phrases:["i would appreciate","could you please","thank you for","i am writing to"],weight:0},casual:{keywords:["hey","cool","awesome","sounds good","no worries","thanks"],phrases:["sounds good","no worries","hey there","cool, thanks"],weight:0},direct:{keywords:["need","want","require","must","should","will"],phrases:["i need","we want","this must","you should","let me know"],weight:0},consultative:{keywords:["suggest","recommend","consider","explore","evaluate","assess"],phrases:["i suggest","you might consider","let's explore","what do you think"],weight:0}};Object.keys(b).forEach(c=>{let d=b[c];d.keywords.forEach(b=>{a.includes(b)&&(d.weight+=1)}),d.phrases.forEach(b=>{a.includes(b)&&(d.weight+=2)})});let c=Object.keys(b).reduce((a,c)=>b[a].weight>b[c].weight?a:c),d=Math.min(.9,.1*b[c].weight);return d<.3?{confidence:0}:{tone:c,confidence:d,indicators:b[c].weight,detected_at:new Date().toISOString()}}extractProfessionalContext(a){let b="",c=0,d="";Object.entries({sales:["sales","quota","pipeline","deals","prospects","leads","close","revenue"],marketing:["marketing","campaigns","brand","content","demand gen","mql","attribution"],executive:["ceo","cto","vp","director","head of","chief","founder","president"],operations:["operations","process","efficiency","workflow","automation","systems"]}).forEach(([d,e])=>{let f=e.filter(b=>a.includes(b)).length;f>c&&(c=f,b=d)}),["years of experience","worked at","previously at","background in","experience with","familiar with","used to work"].forEach(b=>{if(a.includes(b)){let c=a.match(RegExp(`(\\d+)\\+?\\s*years?\\s*${b}`,"i"));if(c){let a=parseInt(c[1]);d=a>=10?"senior":a>=5?"mid":"junior"}}});let e=c>0?Math.min(.9,.15*c):0;return e<.3?{confidence:0}:{role:b,experience_level:d,confidence:e,role_indicators:c,detected_at:new Date().toISOString()}}extractCustomerIntelligence(a){let b=[],c=[],d=[];["problem","challenge","struggle","difficult","issue","pain point","bottleneck","obstacle","frustration","concern","worry"].forEach(c=>{if(a.includes(c)){let d=RegExp(`([^.!?]*${c}[^.!?]*)`,"gi"),e=a.match(d);e&&b.push(...e.map(a=>a.trim()))}}),["growth","scaling","expansion","funding","budget approved","new team","hiring","deadline","compliance","audit"].forEach(b=>{a.includes(b)&&c.push(b)}),["increase","improve","reduce","save","roi","efficiency","conversion","performance","productivity","revenue"].forEach(b=>{a.includes(b)&&d.push(b)});let e=b.length+c.length+d.length,f=e>0?Math.min(.9,.2*e):0;return f<.3?{confidence:0}:{pain_points:b.slice(0,5),buying_triggers:c,success_metrics:d,confidence:f,total_indicators:e,detected_at:new Date().toISOString()}}extractMarketInsights(a){let b=[],c=[],d=[];["saas","software","technology","healthcare","finance","fintech","manufacturing","retail","e-commerce","education","real estate","consulting","agency","startup","enterprise"].forEach(c=>{a.includes(c)&&b.push(c)}),["market trends","industry standards","competitive landscape","market share","growth rate","market size","regulation","compliance"].forEach(b=>{a.includes(b)&&c.push(b)}),["startup","small business","mid-market","enterprise","fortune","1-10 employees","10-50 employees","50-200 employees","200+ employees"].forEach(b=>{a.includes(b)&&d.push(b)});let e=b.length+c.length+d.length,f=e>0?Math.min(.8,.25*e):0;return f<.3?{confidence:0}:{industry:b,market_conditions:c,company_size:d,confidence:f,total_indicators:e,detected_at:new Date().toISOString()}}extractCompetitiveIntelligence(a){let b=[],c=[],d=0;["competitor","competition","alternative","vs ","versus","compare","instead of","better than","different from","similar to"].forEach(c=>{if(a.includes(c)){d++;let e=RegExp(`${c}\\s+([A-Za-z0-9\\s]{2,30})`,"gi"),f=a.match(e);f&&b.push(...f)}}),["compared to","in comparison","unlike","whereas","however","on the other hand","alternatively","but","rather than"].forEach(b=>{if(a.includes(b)){let d=RegExp(`([^.!?]*${b}[^.!?]*)`,"gi"),e=a.match(d);e&&c.push(...e.map(a=>a.trim()))}});let e=d>0?Math.min(.85,.3*d):0;return e<.4?{confidence:0}:{competitor_mentions:b.slice(0,3),comparison_points:c.slice(0,3),competitive_context_strength:d,confidence:e,detected_at:new Date().toISOString()}}getFallbackClassification(a){let b=a.toLowerCase();return{personal_data:{communication_style:this.detectCommunicationStyle(b)},team_shareable:{customer_intelligence:this.extractCustomerIntelligence(b)},classification_confidence:.5,patterns_matched:["fallback_classification"]}}async extractAndStoreKnowledge(a){try{let{data:b,error:c}=await f.rpc("extract_knowledge_from_conversation",{p_conversation_id:a});if(c)return console.error("Error extracting knowledge:",c),{success:!1,error:c.message};return{success:!0,result:b}}catch(a){return console.error("Knowledge extraction error:",a),{success:!1,error:"Failed to extract knowledge"}}}async getUserKnowledgeContext(a,b,c=["personal","team_shareable"],d=50){try{let{data:e,error:g}=await f.rpc("get_user_knowledge_context",{p_user_id:a,p_organization_id:b,p_knowledge_types:c,p_limit:d});if(g)return console.error("Error getting knowledge context:",g),{personal_knowledge:{},team_knowledge:{}};return e}catch(a){return console.error("Knowledge context error:",a),{personal_knowledge:{},team_knowledge:{}}}}async getUserPrivacyPreferences(a){try{let{data:b,error:c}=await f.from("sam_user_privacy_preferences").select("*").eq("user_id",a).single();if(c)return{user_id:a,communication_style_sharing:"user",professional_context_sharing:"team",customer_intelligence_sharing:"organization",market_insights_sharing:"organization",auto_knowledge_extraction:!0,require_extraction_confirmation:!1,data_retention_days:365};return b}catch(a){return console.error("Error getting privacy preferences:",a),null}}async updatePrivacyPreferences(a,b){try{let{error:c}=await f.from("sam_user_privacy_preferences").upsert({user_id:a,...b,updated_at:new Date().toISOString()});if(c)return console.error("Error updating privacy preferences:",c),!1;return!0}catch(a){return console.error("Privacy preferences update error:",a),!1}}async getExtractedKnowledge(a,b,c,d,e=100){try{let g=f.from("sam_extracted_knowledge").select("*").eq("is_active",!0).order("updated_at",{ascending:!1}).limit(e);a&&(g=g.eq("user_id",a)),b&&(g=g.eq("organization_id",b)),c&&(g=g.eq("knowledge_type",c)),d&&(g=g.eq("category",d));let{data:h,error:i}=await g;if(i)return console.error("Error getting extracted knowledge:",i),[];return h}catch(a){return console.error("Extracted knowledge retrieval error:",a),[]}}}let h=new g},78335:()=>{},96487:()=>{}};