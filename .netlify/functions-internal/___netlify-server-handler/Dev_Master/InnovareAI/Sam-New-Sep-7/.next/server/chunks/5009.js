"use strict";exports.id=5009,exports.ids=[5009],exports.modules={95009:(a,b,c)=>{c.d(b,{P7:()=>j,Q7:()=>i});var d=c(52153);class e{constructor(a){this.config=a,this.baseUrl=`https://${a.dsn}`}async listTools(){return{tools:[{name:"unipile_get_accounts",description:"Get all connected messaging accounts from supported platforms",inputSchema:{type:"object",properties:{},required:[]}},{name:"unipile_get_recent_messages",description:"Get recent messages from all chats associated with a specific account",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"The source ID of the account to get messages from"},batch_size:{type:"integer",description:"Number of messages to fetch per chat",default:20}},required:["account_id"]}},{name:"unipile_get_emails",description:"Get recent emails from a specific email account",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"The ID of the account to get emails from"},limit:{type:"integer",description:"Maximum number of emails to return",default:10}},required:["account_id"]}},{name:"unipile_send_message",description:"Send a message through a connected platform",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"The source ID of the account to send from"},recipient:{type:"string",description:"Recipient identifier (email, phone, user ID)"},message:{type:"string",description:"Message content to send"},platform:{type:"string",enum:["linkedin","whatsapp","instagram","email","slack"],description:"Platform to send message through"}},required:["account_id","recipient","message","platform"]}},{name:"unipile_connect_account",description:"Initiate OAuth connection flow for a new platform account",inputSchema:{type:"object",properties:{platform:{type:"string",enum:["linkedin","whatsapp","instagram","messenger","telegram","twitter","slack","email"],description:"Platform to connect"},callback_url:{type:"string",description:"OAuth callback URL for authorization"}},required:["platform"]}},{name:"unipile_linkedin_search_people",description:"Search LinkedIn for people using authenticated account (Unipile native capability)",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"LinkedIn account ID to search with"},keywords:{type:"string",description:"Search keywords for people"},filters:{type:"object",properties:{current_company:{type:"array",items:{type:"string"}},past_company:{type:"array",items:{type:"string"}},title:{type:"array",items:{type:"string"}},location:{type:"array",items:{type:"string"}},industry:{type:"array",items:{type:"string"}},school:{type:"array",items:{type:"string"}},connection_degree:{type:"string",enum:["1","2","3"]},seniority_level:{type:"array",items:{type:"string"}}}},limit:{type:"number",default:25,maximum:100},workspace_id:{type:"string"},user_id:{type:"string"}},required:["account_id","workspace_id","user_id"]}},{name:"unipile_linkedin_search_jobs",description:"Search LinkedIn job postings (Unipile native feature)",inputSchema:{type:"object",properties:{account_id:{type:"string"},keywords:{type:"string"},location:{type:"string"},company:{type:"string"},job_type:{type:"string",enum:["full-time","part-time","contract","internship"]},experience_level:{type:"string"},limit:{type:"number",default:25},workspace_id:{type:"string"},user_id:{type:"string"}},required:["account_id","workspace_id","user_id"]}},{name:"unipile_linkedin_create_outreach_sequence",description:"Create automated LinkedIn outreach sequences (Unipile premium feature)",inputSchema:{type:"object",properties:{account_id:{type:"string"},sequence_name:{type:"string"},target_profiles:{type:"array",items:{type:"string"}},messages:{type:"array",items:{type:"object",properties:{delay_days:{type:"number"},message_template:{type:"string"},follow_up_action:{type:"string"}}}},workspace_id:{type:"string"},user_id:{type:"string"}},required:["account_id","sequence_name","target_profiles","messages","workspace_id","user_id"]}},{name:"unipile_linkedin_send_inmail",description:"Send LinkedIn InMail messages (requires InMail credits)",inputSchema:{type:"object",properties:{account_id:{type:"string"},recipient_profile_url:{type:"string"},subject:{type:"string"},message:{type:"string"},workspace_id:{type:"string"},user_id:{type:"string"}},required:["account_id","recipient_profile_url","subject","message","workspace_id","user_id"]}},{name:"unipile_linkedin_check_inmail_credits",description:"Check available InMail credits for LinkedIn account",inputSchema:{type:"object",properties:{account_id:{type:"string"},workspace_id:{type:"string"},user_id:{type:"string"}},required:["account_id","workspace_id","user_id"]}},{name:"unipile_linkedin_endorse_skills",description:"Endorse skills on LinkedIn profiles (relationship building)",inputSchema:{type:"object",properties:{account_id:{type:"string"},profile_url:{type:"string"},skills_to_endorse:{type:"array",items:{type:"string"}},workspace_id:{type:"string"},user_id:{type:"string"}},required:["account_id","profile_url","skills_to_endorse","workspace_id","user_id"]}},{name:"unipile_linkedin_get_profile_viewers",description:"Get list of people who viewed your LinkedIn profile",inputSchema:{type:"object",properties:{account_id:{type:"string"},limit:{type:"number",default:50},workspace_id:{type:"string"},user_id:{type:"string"}},required:["account_id","workspace_id","user_id"]}},{name:"unipile_linkedin_search_companies",description:"Search LinkedIn for companies using authenticated account",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"LinkedIn account ID to search with"},keywords:{type:"string",description:"Search keywords for companies"},filters:{type:"object",properties:{company_size:{type:"array",items:{type:"string"}},industry:{type:"array",items:{type:"string"}},location:{type:"array",items:{type:"string"}},company_type:{type:"array",items:{type:"string"}},funding_stage:{type:"array",items:{type:"string"}}}},limit:{type:"number",default:25,maximum:50},workspace_id:{type:"string"},user_id:{type:"string"}},required:["account_id","workspace_id","user_id"]}},{name:"unipile_linkedin_get_profile",description:"Get detailed LinkedIn profile data using authenticated account",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"LinkedIn account ID to use for access"},profile_url:{type:"string",description:"LinkedIn profile URL to fetch"},include_posts:{type:"boolean",default:!1},include_connections:{type:"boolean",default:!1},include_contact_info:{type:"boolean",default:!1},workspace_id:{type:"string"},user_id:{type:"string"}},required:["account_id","profile_url","workspace_id","user_id"]}},{name:"unipile_linkedin_get_company_employees",description:"Get employees of a company from LinkedIn using authenticated account",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"LinkedIn account ID to use for access"},company_id:{type:"string",description:"LinkedIn company ID or URL"},filters:{type:"object",properties:{title_keywords:{type:"array",items:{type:"string"}},seniority_level:{type:"array",items:{type:"string"}},department:{type:"array",items:{type:"string"}},connection_degree:{type:"string",enum:["1","2","3"]}}},limit:{type:"number",default:50,maximum:200},workspace_id:{type:"string"},user_id:{type:"string"}},required:["account_id","company_id","workspace_id","user_id"]}},{name:"unipile_get_conversations",description:"Get conversation threads for a specific account",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"The account ID to get conversations from"},limit:{type:"integer",description:"Maximum number of conversations to return",default:20},platform:{type:"string",description:"Filter by specific platform"}},required:["account_id"]}},{name:"unipile_analyze_sentiment",description:"Analyze sentiment and engagement metrics for conversations",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"The account ID to analyze"},conversation_ids:{type:"array",items:{type:"string"},description:"Specific conversation IDs to analyze"},time_range:{type:"object",properties:{start:{type:"string",description:"Start date (ISO 8601)"},end:{type:"string",description:"End date (ISO 8601)"}}}},required:["account_id"]}},{name:"unipile_schedule_meeting",description:"Schedule a meeting using integrated calendar APIs",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"Calendar account ID to use for scheduling"},title:{type:"string",description:"Meeting title"},description:{type:"string",description:"Meeting description/agenda"},start_time:{type:"string",description:"Meeting start time (ISO 8601)"},duration_minutes:{type:"integer",description:"Meeting duration in minutes",default:30},attendees:{type:"array",items:{type:"object",properties:{email:{type:"string"},name:{type:"string"},optional:{type:"boolean",default:!1}},required:["email"]},description:"Meeting attendees"},location:{type:"string",description:"Meeting location or video conferencing link"}},required:["account_id","title","start_time","attendees"]}},{name:"unipile_get_availability",description:"Check calendar availability for scheduling",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"Calendar account ID to check"},attendee_emails:{type:"array",items:{type:"string"},description:"Email addresses to check availability for"},date_range:{type:"object",properties:{start:{type:"string",description:"Start date (ISO 8601)"},end:{type:"string",description:"End date (ISO 8601)"}},required:["start","end"]},duration_minutes:{type:"integer",description:"Required meeting duration in minutes",default:30}},required:["account_id","date_range"]}},{name:"unipile_send_email_sequence",description:"Send automated email sequences for sales outreach",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"Email account to send from"},sequence_template:{type:"string",enum:["cold_outreach","followup_demo","nurturing","closing"],description:"Predefined sequence template"},recipient:{type:"object",properties:{email:{type:"string"},name:{type:"string"},company:{type:"string"},title:{type:"string"}},required:["email","name"]},personalization_data:{type:"object",description:"Custom data for email personalization"},schedule_delays:{type:"array",items:{type:"integer"},description:"Delays in days between sequence emails",default:[0,3,7,14]}},required:["account_id","sequence_template","recipient"]}},{name:"unipile_track_email_engagement",description:"Track email opens, clicks, and responses for sales insights",inputSchema:{type:"object",properties:{account_id:{type:"string",description:"Email account ID to track"},campaign_id:{type:"string",description:"Specific campaign or sequence ID"},time_range:{type:"object",properties:{start:{type:"string",description:"Start date (ISO 8601)"},end:{type:"string",description:"End date (ISO 8601)"}}},metrics:{type:"array",items:{type:"string",enum:["opens","clicks","replies","bounces","unsubscribes"]},description:"Engagement metrics to track"}},required:["account_id"]}}]}}async callTool(a){try{switch(a.params.name){case"unipile_get_accounts":return await this.getAccounts();case"unipile_get_recent_messages":return await this.getRecentMessages(a.params.arguments?.account_id,a.params.arguments?.batch_size);case"unipile_get_emails":return await this.getEmails(a.params.arguments?.account_id,a.params.arguments?.limit);case"unipile_send_message":return await this.sendMessage(a.params.arguments?.account_id,a.params.arguments?.recipient,a.params.arguments?.message,a.params.arguments?.platform);case"unipile_connect_account":return await this.connectAccount(a.params.arguments?.platform,a.params.arguments?.callback_url);case"unipile_get_conversations":return await this.getConversations(a.params.arguments?.account_id,a.params.arguments?.limit,a.params.arguments?.platform);case"unipile_analyze_sentiment":return await this.analyzeSentiment(a.params.arguments?.account_id,a.params.arguments?.conversation_ids,a.params.arguments?.time_range);case"unipile_schedule_meeting":return await this.scheduleMeeting(a.params.arguments?.account_id,a.params.arguments?.title,a.params.arguments?.description,a.params.arguments?.start_time,a.params.arguments?.duration_minutes,a.params.arguments?.attendees,a.params.arguments?.location);case"unipile_get_availability":return await this.getAvailability(a.params.arguments?.account_id,a.params.arguments?.attendee_emails,a.params.arguments?.date_range,a.params.arguments?.duration_minutes);case"unipile_send_email_sequence":return await this.sendEmailSequence(a.params.arguments?.account_id,a.params.arguments?.sequence_template,a.params.arguments?.recipient,a.params.arguments?.personalization_data,a.params.arguments?.schedule_delays);case"unipile_track_email_engagement":return await this.trackEmailEngagement(a.params.arguments?.account_id,a.params.arguments?.campaign_id,a.params.arguments?.time_range,a.params.arguments?.metrics);default:return{content:[{type:"text",text:`Unknown Unipile tool: ${a.params.name}`}],isError:!0}}}catch(a){return{content:[{type:"text",text:`Unipile MCP error: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async getAccounts(){try{let a=await fetch(`${this.baseUrl}/accounts`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});if(!a.ok)throw Error(`HTTP ${a.status}: ${a.statusText}`);let b=await a.json();return{content:[{type:"text",text:JSON.stringify({accounts:b.map(a=>({id:a.id,name:a.name,platform:a.platform,status:a.status,sources:a.sources,created_at:a.created_at})),total:b.length,platforms:[...new Set(b.map(a=>a.platform))]},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to get accounts: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async getRecentMessages(a,b=20){try{let c=await fetch(`${this.baseUrl}/accounts/${a}/messages?limit=${b}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});if(!c.ok)throw Error(`HTTP ${c.status}: ${c.statusText}`);let d=await c.json();return{content:[{type:"text",text:JSON.stringify({messages:d.map(a=>({id:a.id,text:a.text,sender:a.sender,recipient:a.recipient,timestamp:a.timestamp,platform:a.platform,conversation_id:a.conversation_id,message_type:a.message_type,attachments:a.attachments?.length||0,has_reactions:(a.reactions?.length||0)>0})),total:d.length,platforms:[...new Set(d.map(a=>a.platform))],conversations:[...new Set(d.map(a=>a.conversation_id))]},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to get messages: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async getEmails(a,b=10){try{let c=await fetch(`${this.baseUrl}/accounts/${a}/emails?limit=${b}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});if(!c.ok)throw Error(`HTTP ${c.status}: ${c.statusText}`);let d=await c.json();return{content:[{type:"text",text:JSON.stringify({emails:d.map(a=>({id:a.id,subject:a.subject,body:a.body.substring(0,200)+(a.body.length>200?"...":""),sender:a.sender,recipients:a.recipients,timestamp:a.timestamp,read:a.read,attachments:a.attachments?.length||0,labels:a.labels})),total:d.length,unread:d.filter(a=>!a.read).length},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to get emails: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async sendMessage(a,b,c,d){try{let e=await fetch(`${this.baseUrl}/accounts/${a}/messages`,{method:"POST",headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({recipient:b,text:c,platform:d})});if(!e.ok)throw Error(`HTTP ${e.status}: ${e.statusText}`);let f=await e.json();return{content:[{type:"text",text:JSON.stringify({message:"Message sent successfully",message_id:f.id,platform:d,recipient:b,sent_at:f.timestamp||new Date().toISOString()},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to send message: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async connectAccount(a,b){try{let c=await fetch(`${this.baseUrl}/oauth/authorize`,{method:"POST",headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({platform:a,callback_url:b||`${process.env.NEXT_PUBLIC_APP_URL}/api/integrations/unipile/callback`,client_id:this.config.clientId})});if(!c.ok)throw Error(`HTTP ${c.status}: ${c.statusText}`);let d=await c.json();return{content:[{type:"text",text:JSON.stringify({message:"OAuth flow initiated",authorization_url:d.authorization_url,platform:a,expires_in:d.expires_in||600,instructions:`Open the authorization URL to connect your ${a} account`},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to initiate account connection: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async getConversations(a,b=20,c){try{let d=new URLSearchParams({limit:b.toString()});c&&d.append("platform",c);let e=await fetch(`${this.baseUrl}/accounts/${a}/conversations?${d}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});if(!e.ok)throw Error(`HTTP ${e.status}: ${e.statusText}`);let f=await e.json();return{content:[{type:"text",text:JSON.stringify({conversations:f.map(a=>({id:a.id,participant:a.participant,platform:a.platform,last_message:a.last_message,message_count:a.message_count,unread_count:a.unread_count,updated_at:a.updated_at})),total:f.length,platforms:c?[c]:[...new Set(f.map(a=>a.platform))]},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to get conversations: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async analyzeSentiment(a,b,c){try{let c={account_id:a,overall_sentiment:"positive",sentiment_score:.75,engagement_metrics:{response_rate:.82,average_response_time:"2.5 hours",conversation_length:8.2,emoji_usage:.45},conversation_breakdown:b?.map(a=>({conversation_id:a,sentiment:"positive",score:.4*Math.random()+.6,key_topics:["product interest","pricing","timeline"],engagement_level:"high"}))||[],recommendations:["High engagement - good time to propose next steps","Positive sentiment indicates strong product fit","Consider scheduling demo or consultation"]};return{content:[{type:"text",text:JSON.stringify(c,null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to analyze sentiment: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async scheduleMeeting(a,b,c,d,e=30,f,g){try{let h={title:b,description:c,start_time:d,end_time:new Date(new Date(d).getTime()+6e4*e).toISOString(),attendees:f?.map(a=>({email:a.email,name:a.name,optional:a.optional||!1}))||[],location:g||"Video Conference"},i=await fetch(`${this.baseUrl}/accounts/${a}/calendar/events`,{method:"POST",headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!i.ok)throw Error(`HTTP ${i.status}: ${i.statusText}`);let j=await i.json();return{content:[{type:"text",text:JSON.stringify({message:"Meeting scheduled successfully",meeting_id:j.id,title:j.title,start_time:j.start_time,end_time:j.end_time,attendees_count:j.attendees?.length||0,meeting_link:j.meeting_url||j.location,calendar_invite_sent:!0,timezone:j.timezone||"UTC"},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to schedule meeting: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async getAvailability(a,b,c,d=30){try{let e=new URLSearchParams({start:c?.start||new Date().toISOString(),end:c?.end||new Date(Date.now()+6048e5).toISOString(),duration:d.toString()});b&&b.length>0&&e.append("attendees",b.join(","));let f=await fetch(`${this.baseUrl}/accounts/${a}/calendar/freebusy?${e}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});if(!f.ok)throw Error(`HTTP ${f.status}: ${f.statusText}`);let g=await f.json(),h=this.generateMeetingTimesSuggestions(c?.start||new Date().toISOString(),c?.end||new Date(Date.now()+6048e5).toISOString(),d,g.busy_periods||[]);return{content:[{type:"text",text:JSON.stringify({account_id:a,date_range:c,duration_minutes:d,attendees_checked:b?.length||1,availability_summary:{total_free_slots:h.length,next_available:h[0]?.start_time,busy_periods_count:g.busy_periods?.length||0},suggested_times:h.slice(0,5),busy_periods:g.busy_periods?.map(a=>({start:a.start,end:a.end,title:a.title||"Busy"}))||[]},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to get availability: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async sendEmailSequence(a,b,c,d,e=[0,3,7,14]){try{let f=this.getEmailSequenceTemplate(b),g=`seq-${Date.now()}`,h=e.map((a,b)=>({sequence_number:b+1,delay_days:a,subject:this.personalizeEmailContent(f.emails[b]?.subject||`Follow-up ${b+1}`,c,d),body:this.personalizeEmailContent(f.emails[b]?.body||f.default_body,c,d),scheduled_time:new Date(Date.now()+24*a*36e5).toISOString()})),i=await fetch(`${this.baseUrl}/accounts/${a}/email/sequences`,{method:"POST",headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({sequence_id:g,template:b,recipient:{email:c.email,name:c.name,company:c.company,title:c.title},emails:h,personalization:d||{}})});if(!i.ok)throw Error(`HTTP ${i.status}: ${i.statusText}`);return await i.json(),{content:[{type:"text",text:JSON.stringify({message:"Email sequence scheduled successfully",sequence_id:g,template:b,recipient:c.email,total_emails:h.length,schedule_summary:h.map(a=>({email_number:a.sequence_number,send_date:a.scheduled_time,subject:a.subject})),tracking_enabled:!0,unsubscribe_link_included:!0},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to send email sequence: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async trackEmailEngagement(a,b,c,d=["opens","clicks","replies"]){try{let e=new URLSearchParams;b&&e.append("campaign_id",b),c?.start&&e.append("start",c.start),c?.end&&e.append("end",c.end),d.forEach(a=>e.append("metrics",a));let f=await fetch(`${this.baseUrl}/accounts/${a}/email/analytics?${e}`,{headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"}});if(!f.ok)throw Error(`HTTP ${f.status}: ${f.statusText}`);let g=await f.json(),h=this.calculateEngagementInsights(g);return{content:[{type:"text",text:JSON.stringify({account_id:a,campaign_id:b,time_range:c,engagement_summary:{total_emails_sent:g.sent||0,open_rate:g.opens?(g.opens/g.sent*100).toFixed(2)+"%":"0%",click_rate:g.clicks?(g.clicks/g.sent*100).toFixed(2)+"%":"0%",reply_rate:g.replies?(g.replies/g.sent*100).toFixed(2)+"%":"0%",bounce_rate:g.bounces?(g.bounces/g.sent*100).toFixed(2)+"%":"0%"},detailed_metrics:{opens:g.opens||0,unique_opens:g.unique_opens||0,clicks:g.clicks||0,unique_clicks:g.unique_clicks||0,replies:g.replies||0,forwards:g.forwards||0,unsubscribes:g.unsubscribes||0,bounces:g.bounces||0},top_performing_emails:g.top_emails||[],engagement_insights:h,recommendations:this.generateEmailOptimizationRecommendations(g)},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to track email engagement: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}generateMeetingTimesSuggestions(a,b,c,d){let e=[],f=new Date(a),g=new Date(b);for(let a=new Date(f);a<=g;a.setDate(a.getDate()+1))if(a.getDay()>=1&&5>=a.getDay())for(let b=9;b<=16;b++){let f=new Date(a);f.setHours(b,0,0,0);let g=new Date(f);g.setMinutes(g.getMinutes()+c),d.some(a=>{let b=new Date(a.start),c=new Date(a.end);return f>=b&&f<c||g>b&&g<=c||f<=b&&g>=c})||e.push({start_time:f.toISOString(),end_time:g.toISOString(),confidence:b>=10&&b<=14?"high":"medium"})}return e.slice(0,10)}getEmailSequenceTemplate(a){let b={cold_outreach:{emails:[{subject:"Quick question about {{company}}'s {{pain_point}}",body:"Hi {{first_name}},\n\nI noticed {{company}} is working on {{specific_initiative}}. Many companies in {{industry}} are facing similar challenges with {{pain_point}}.\n\nWe've helped similar companies achieve {{specific_benefit}}. Would you be open to a brief conversation about your approach?\n\nBest regards"},{subject:"Following up on my previous email",body:"Hi {{first_name}},\n\nI wanted to follow up on my previous email. I understand you're probably busy, but I thought this case study might be relevant:\n\n{{case_study_link}}\n\nWould a 15-minute call this week work for you?\n\nBest regards"}],default_body:"Professional outreach template"},followup_demo:{emails:[{subject:"Thank you for the demo - next steps",body:"Hi {{first_name}},\n\nThank you for taking the time to see our demo yesterday. Based on our conversation, I believe we can help {{company}} achieve {{discussed_goals}}.\n\nAs promised, I've attached:\n- ROI calculator specific to your use case\n- Implementation timeline\n- Reference customer contact\n\nWhat questions can I answer for you?\n\nBest regards"}],default_body:"Demo follow-up template"},nurturing:{emails:[{subject:"Thought you'd find this interesting - {{industry}} trends",body:"Hi {{first_name}},\n\nI came across this article about {{industry}} trends and thought you might find it relevant given your role at {{company}}.\n\n{{article_link}}\n\nThe section on {{relevant_topic}} particularly reminded me of our previous conversation.\n\nBest regards"}],default_body:"Nurturing template"},closing:{emails:[{subject:"Final steps to get {{company}} started",body:"Hi {{first_name}},\n\nI wanted to check in on the status of our proposal. Our team is excited about the opportunity to work with {{company}}.\n\nTo move forward, we just need:\n- {{requirement_1}}\n- {{requirement_2}}\n- {{requirement_3}}\n\nI'm here to help with any questions or concerns.\n\nBest regards"}],default_body:"Closing template"}};return b[a]||b.cold_outreach}personalizeEmailContent(a,b,c){let d=a;return d=(d=(d=d.replace(/{{first_name}}/g,b.name?.split(" ")[0]||"there")).replace(/{{company}}/g,b.company||"your company")).replace(/{{title}}/g,b.title||"your role"),c&&Object.keys(c).forEach(a=>{let b=`{{${a}}}`;d=d.replace(RegExp(b,"g"),c[a])}),d}calculateEngagementInsights(a){let b=[];return a.open_rate>.25?b.push("Strong subject line performance - open rate above industry average"):a.open_rate<.15&&b.push("Subject lines may need optimization - open rate below average"),a.click_rate>.03?b.push("Good email content engagement - click rate above average"):a.click_rate<.02&&b.push("Email content could be more engaging - consider stronger CTAs"),a.reply_rate>.05&&b.push("Excellent conversation starter - high reply rate"),b}generateEmailOptimizationRecommendations(a){let b=[];return a.open_rate<.2&&(b.push("A/B test subject lines with personalization and urgency"),b.push("Send emails on Tuesday-Thursday, 10-11 AM for better open rates")),a.click_rate<.025&&(b.push("Include stronger call-to-action buttons"),b.push("Shorten email content and focus on single objective")),a.reply_rate<.03&&(b.push("End emails with specific questions to encourage responses"),b.push("Increase personalization based on recipient's industry/role")),a.unsubscribe_rate>.005&&(b.push("Review email frequency - may be sending too often"),b.push("Segment audience better for more relevant content")),b.length>0?b:["Continue current email strategy - metrics look healthy"]}}class f{constructor(a){this.config=a,this.clientId=`n8n-client-${Date.now()}`}async listTools(){return{tools:[{name:"n8n_list_workflows",description:"List all workflows in the N8N instance",inputSchema:{type:"object",properties:{active:{type:"boolean",description:"Filter by active status"},limit:{type:"integer",description:"Maximum number of workflows to return",default:100}},required:[]}},{name:"n8n_get_workflow",description:"Get detailed workflow information by ID",inputSchema:{type:"object",properties:{workflow_id:{type:"string",description:"The workflow ID to retrieve"}},required:["workflow_id"]}},{name:"n8n_create_workflow",description:"Create a new workflow with nodes and connections",inputSchema:{type:"object",properties:{name:{type:"string",description:"Workflow name"},nodes:{type:"array",description:"Array of workflow nodes",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"},parameters:{type:"object"},position:{type:"array",items:{type:"number"},minItems:2,maxItems:2}},required:["name","type","position"]}},connections:{type:"object",description:"Node connections configuration"}},required:["name","nodes","connections"]}},{name:"n8n_execute_workflow",description:"Execute a workflow manually",inputSchema:{type:"object",properties:{workflow_id:{type:"string",description:"The workflow ID to execute"},input_data:{type:"object",description:"Input data for the workflow execution"}},required:["workflow_id"]}},{name:"n8n_get_executions",description:"Get workflow execution history",inputSchema:{type:"object",properties:{workflow_id:{type:"string",description:"Filter by workflow ID"},status:{type:"string",enum:["success","error","running"],description:"Filter by execution status"},limit:{type:"integer",description:"Maximum number of executions to return",default:50}},required:[]}},{name:"n8n_create_sam_prospect_workflow",description:"Create a SAM AI-optimized prospect research workflow",inputSchema:{type:"object",properties:{workflow_name:{type:"string",description:"Name for the prospect research workflow"},data_sources:{type:"array",items:{type:"string",enum:["linkedin","apollo","brightdata","websearch"]},description:"Data sources to include in the workflow"},output_format:{type:"string",enum:["json","csv","airtable","supabase"],description:"Output format for prospect data",default:"supabase"}},required:["workflow_name","data_sources"]}},{name:"n8n_create_outreach_workflow",description:"Create a multi-channel outreach automation workflow",inputSchema:{type:"object",properties:{workflow_name:{type:"string",description:"Name for the outreach workflow"},channels:{type:"array",items:{type:"string",enum:["email","linkedin","twitter","slack"]},description:"Communication channels to include"},sequence_days:{type:"array",items:{type:"integer"},description:"Days to wait between outreach steps",default:[0,3,7,14]}},required:["workflow_name","channels"]}},{name:"n8n_health_check",description:"Check N8N instance health and connectivity",inputSchema:{type:"object",properties:{},required:[]}}]}}async callTool(a){try{switch(a.params.name){case"n8n_list_workflows":return await this.listWorkflows(a.params.arguments?.active,a.params.arguments?.limit);case"n8n_get_workflow":return await this.getWorkflow(a.params.arguments?.workflow_id);case"n8n_create_workflow":return await this.createWorkflow(a.params.arguments?.name,a.params.arguments?.nodes,a.params.arguments?.connections);case"n8n_execute_workflow":return await this.executeWorkflow(a.params.arguments?.workflow_id,a.params.arguments?.input_data);case"n8n_get_executions":return await this.getExecutions(a.params.arguments?.workflow_id,a.params.arguments?.status,a.params.arguments?.limit);case"n8n_create_sam_prospect_workflow":return await this.createSAMProspectWorkflow(a.params.arguments?.workflow_name,a.params.arguments?.data_sources,a.params.arguments?.output_format);case"n8n_create_outreach_workflow":return await this.createOutreachWorkflow(a.params.arguments?.workflow_name,a.params.arguments?.channels,a.params.arguments?.sequence_days);case"n8n_health_check":return await this.healthCheck();default:return{content:[{type:"text",text:`Unknown N8N tool: ${a.params.name}`}],isError:!0}}}catch(a){return{content:[{type:"text",text:`N8N MCP error: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async makeRequest(a,b={}){let c=await fetch(`${this.config.baseUrl}/api/v1${a}`,{...b,headers:{"X-N8N-API-KEY":this.config.apiKey,"Content-Type":"application/json",...b.headers}});if(!c.ok)throw Error(`N8N API error: ${c.status} ${c.statusText}`);return await c.json()}async listWorkflows(a,b=100){try{let c=new URLSearchParams;void 0!==a&&c.append("active",a.toString()),c.append("limit",b.toString());let d=await this.makeRequest(`/workflows?${c}`);return{content:[{type:"text",text:JSON.stringify({workflows:d.data?.map(a=>({id:a.id,name:a.name,active:a.active,createdAt:a.createdAt,updatedAt:a.updatedAt,nodeCount:a.nodes?.length||0,tags:a.tags?.map(a=>a.name)||[]}))||[],total:d.data?.length||0,active_count:d.data?.filter(a=>a.active).length||0},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to list workflows: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async getWorkflow(a){try{let b=await this.makeRequest(`/workflows/${a}`);return{content:[{type:"text",text:JSON.stringify({id:b.id,name:b.name,active:b.active,nodes:b.nodes?.map(a=>({id:a.id,name:a.name,type:a.type,position:a.position}))||[],connections:b.connections||{},settings:b.settings||{},tags:b.tags?.map(a=>a.name)||[],createdAt:b.createdAt,updatedAt:b.updatedAt},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to get workflow: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async createWorkflow(a,b,c){try{let d={name:a,nodes:b.map((a,b)=>({id:a.id||`node-${b}`,name:a.name,type:a.type,typeVersion:a.typeVersion||1,position:a.position,parameters:a.parameters||{}})),connections:c||{},active:!1},e=await this.makeRequest("/workflows",{method:"POST",body:JSON.stringify(d)});return{content:[{type:"text",text:JSON.stringify({message:"Workflow created successfully",workflow_id:e.id,name:e.name,nodes_count:e.nodes?.length||0,active:e.active,webhook_url:e.nodes?.find(a=>"n8n-nodes-base.webhook"===a.type)?`${this.config.baseUrl}/webhook/${e.id}`:null},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to create workflow: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async executeWorkflow(a,b){try{let c=await this.makeRequest(`/workflows/${a}/execute`,{method:"POST",body:JSON.stringify({inputData:b||{}})});return{content:[{type:"text",text:JSON.stringify({message:"Workflow execution started",execution_id:c.id,workflow_id:a,status:c.status||"running",started_at:c.startedAt||new Date().toISOString()},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to execute workflow: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async getExecutions(a,b,c=50){try{let d=new URLSearchParams;a&&d.append("workflowId",a),b&&d.append("status",b),d.append("limit",c.toString());let e=await this.makeRequest(`/executions?${d}`);return{content:[{type:"text",text:JSON.stringify({executions:e.data?.map(a=>({id:a.id,workflowId:a.workflowId,status:a.status,mode:a.mode,startedAt:a.startedAt,finishedAt:a.finishedAt,duration:a.finishedAt&&a.startedAt?new Date(a.finishedAt).getTime()-new Date(a.startedAt).getTime():null,error:a.error}))||[],total:e.data?.length||0,success_rate:e.data?.length>0?e.data.filter(a=>"success"===a.status).length/e.data.length:0},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to get executions: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async createSAMProspectWorkflow(a,b,c="supabase"){try{let d=[{name:"Webhook Trigger",type:"n8n-nodes-base.webhook",position:[100,100],parameters:{httpMethod:"POST",path:`sam-prospect-${Date.now()}`}}];b.forEach((a,b)=>{switch(a){case"linkedin":d.push({name:"LinkedIn Scraper",type:"n8n-nodes-base.httpRequest",position:[300,100+150*b],parameters:{url:"https://api.linkedin.com/v2/people",method:"GET"}});break;case"apollo":d.push({name:"Apollo Enrichment",type:"n8n-nodes-base.httpRequest",position:[300,100+150*b],parameters:{url:"https://api.apollo.io/v1/people/search",method:"POST"}});break;case"brightdata":d.push({name:"Bright Data Research",type:"n8n-nodes-base.httpRequest",position:[300,100+150*b],parameters:{url:`${process.env.BRIGHT_DATA_ENDPOINT}/research`,method:"POST"}});break;case"websearch":d.push({name:"Web Intelligence",type:"n8n-nodes-base.httpRequest",position:[300,100+150*b],parameters:{url:"https://api.search.brave.com/res/v1/web/search",method:"GET"}})}}),d.push({name:"Merge Data",type:"n8n-nodes-base.merge",position:[500,100],parameters:{mode:"combine",combineBy:"combineByPosition"}}),"supabase"===c&&d.push({name:"Save to Supabase",type:"n8n-nodes-base.supabase",position:[700,100],parameters:{operation:"insert",table:"prospects"}});let e=await this.createWorkflow(a,d,{});return{content:[{type:"text",text:JSON.stringify({message:"SAM Prospect Research workflow created successfully",workflow_id:JSON.parse(e.content[0].text).workflow_id,data_sources:b,output_format:c,webhook_url:`${this.config.baseUrl}/webhook/sam-prospect-${Date.now()}`,setup_instructions:["1. Configure API credentials for each data source","2. Test the webhook endpoint with sample data","3. Activate the workflow when ready","4. Monitor execution logs for optimization"]},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to create SAM prospect workflow: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async createOutreachWorkflow(a,b,c=[0,3,7,14]){try{let d=[{name:"Schedule Trigger",type:"n8n-nodes-base.cron",position:[100,100],parameters:{rule:{hour:9,minute:0}}}];c.forEach((a,c)=>{a>0&&d.push({name:`Wait ${a} Days`,type:"n8n-nodes-base.wait",position:[300+200*c,100],parameters:{amount:a,unit:"days"}}),b.forEach((a,b)=>{switch(a){case"email":d.push({name:`Send Email ${c+1}`,type:"n8n-nodes-base.emailSend",position:[400+200*c,100+100*b],parameters:{subject:`Follow-up ${c+1}`,message:"Personalized outreach message"}});break;case"linkedin":d.push({name:`LinkedIn Message ${c+1}`,type:"n8n-nodes-base.httpRequest",position:[400+200*c,100+100*b],parameters:{url:"https://api.linkedin.com/v2/messages",method:"POST"}})}})});let e=await this.createWorkflow(a,d,{});return{content:[{type:"text",text:JSON.stringify({message:"Multi-channel outreach workflow created successfully",workflow_id:JSON.parse(e.content[0].text).workflow_id,channels:b,sequence_days:c,total_touchpoints:b.length*c.length,setup_instructions:["1. Configure credentials for each communication channel","2. Customize message templates for each touchpoint","3. Set up prospect list and personalization variables","4. Test the sequence with a small group first"]},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to create outreach workflow: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async healthCheck(){try{let a=await this.makeRequest("/health");return{content:[{type:"text",text:JSON.stringify({status:"healthy",n8n_version:a.version||"unknown",client_id:this.clientId,base_url:this.config.baseUrl,timestamp:new Date().toISOString(),capabilities:["workflow_creation","workflow_execution","webhook_triggers","scheduled_executions","sam_ai_optimization"]},null,2)}]}}catch(a){return{content:[{type:"text",text:JSON.stringify({status:"unhealthy",error:a instanceof Error?a.message:"Unknown error",timestamp:new Date().toISOString()},null,2)}],isError:!0}}}}class g{constructor(a){this.config=a,this.modelEndpoints={"claude-sonnet":"https://api.anthropic.com/v1/messages","gpt-4o":"https://api.openai.com/v1/chat/completions","gemini-pro":"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent"}}async listTools(){return{tools:[{name:"reply_agent_generate_response",description:"Generate intelligent responses for sales conversations",inputSchema:{type:"object",properties:{conversation_context:{type:"object",description:"Full conversation context and prospect information",properties:{messages:{type:"array",items:{type:"object",properties:{role:{type:"string",enum:["user","assistant","system"]},content:{type:"string"},timestamp:{type:"string"},platform:{type:"string"}},required:["role","content","timestamp"]}},conversation_stage:{type:"string",enum:["cold_outreach","nurturing","qualification","demo_followup","negotiation","closing"]},sales_methodology:{type:"string",enum:["challenger","spin","meddic","value_selling"]},tone:{type:"string",enum:["professional","casual","consultative","urgent"]},objective:{type:"string"}},required:["messages","conversation_stage","objective"]},reply_options:{type:"object",properties:{response_types:{type:"array",items:{type:"string",enum:["question","value_prop","case_study","next_step","objection_handle"]}},include_personalization:{type:"boolean",default:!0},include_call_to_action:{type:"boolean",default:!0},max_length:{type:"integer",default:150},urgency_level:{type:"string",enum:["low","medium","high"],default:"medium"},compliance_check:{type:"boolean",default:!0}}}},required:["conversation_context"]}},{name:"reply_agent_analyze_sentiment",description:"Analyze conversation sentiment and engagement signals",inputSchema:{type:"object",properties:{conversation_context:{type:"object",description:"Conversation messages to analyze"}},required:["conversation_context"]}},{name:"reply_agent_suggest_next_steps",description:"Suggest strategic next steps based on conversation analysis",inputSchema:{type:"object",properties:{conversation_context:{type:"object",description:"Full conversation context"},current_objectives:{type:"array",items:{type:"string"},description:"Current sales objectives"}},required:["conversation_context"]}},{name:"reply_agent_handle_objection",description:"Generate responses to handle specific objections",inputSchema:{type:"object",properties:{objection_text:{type:"string",description:"The objection raised by the prospect"},objection_type:{type:"string",enum:["price","timing","authority","need","trust","competition"],description:"Category of objection"},conversation_context:{type:"object",description:"Full conversation context for personalization"}},required:["objection_text","objection_type"]}},{name:"reply_agent_generate_followup_sequence",description:"Generate a sequence of follow-up messages for nurturing",inputSchema:{type:"object",properties:{sequence_length:{type:"integer",description:"Number of follow-up messages to generate",default:3},interval_days:{type:"array",items:{type:"integer"},description:"Days between each follow-up",default:[3,7,14]},conversation_context:{type:"object",description:"Current conversation state"}},required:["conversation_context"]}},{name:"reply_agent_optimize_for_platform",description:"Optimize message for specific communication platform",inputSchema:{type:"object",properties:{message:{type:"string",description:"Original message to optimize"},platform:{type:"string",enum:["linkedin","email","whatsapp","slack","twitter"],description:"Target platform for optimization"},platform_constraints:{type:"object",properties:{character_limit:{type:"integer"},supports_formatting:{type:"boolean"},supports_links:{type:"boolean"}}}},required:["message","platform"]}}]}}async callTool(a){try{switch(a.params.name){case"reply_agent_generate_response":return await this.generateResponse(a.params.arguments?.conversation_context,a.params.arguments?.reply_options);case"reply_agent_analyze_sentiment":return await this.analyzeSentiment(a.params.arguments?.conversation_context);case"reply_agent_suggest_next_steps":return await this.suggestNextSteps(a.params.arguments?.conversation_context,a.params.arguments?.current_objectives);case"reply_agent_handle_objection":return await this.handleObjection(a.params.arguments?.objection_text,a.params.arguments?.objection_type,a.params.arguments?.conversation_context);case"reply_agent_generate_followup_sequence":return await this.generateFollowupSequence(a.params.arguments?.conversation_context,a.params.arguments?.sequence_length,a.params.arguments?.interval_days);case"reply_agent_optimize_for_platform":return await this.optimizeForPlatform(a.params.arguments?.message,a.params.arguments?.platform,a.params.arguments?.platform_constraints);default:return{content:[{type:"text",text:`Unknown Reply Agent tool: ${a.params.name}`}],isError:!0}}}catch(a){return{content:[{type:"text",text:`Reply Agent MCP error: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async generateResponse(a,b={response_types:["question","value_prop"],include_personalization:!0,include_call_to_action:!0,max_length:150,urgency_level:"medium",compliance_check:!0}){try{let c=this.buildResponsePrompt(a,b),d=await this.callLLM(c),e=this.parseResponseFromLLM(d,b);return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to generate response: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}buildResponsePrompt(a,b){return`
You are SAM AI, an expert B2B sales assistant. Generate an intelligent response based on this conversation context.

CONVERSATION CONTEXT:
Stage: ${a.conversation_stage}
Methodology: ${a.sales_methodology}
Tone: ${a.tone}
Objective: ${a.objective}

PROSPECT PROFILE:
${a.prospect_profile?`
Name: ${a.prospect_profile.name}
Title: ${a.prospect_profile.title}
Company: ${a.prospect_profile.company}
Industry: ${a.prospect_profile.industry}
Pain Points: ${a.prospect_profile.pain_points?.join(", ")||"Unknown"}
`:"Limited prospect information available"}

RECENT MESSAGES:
${a.messages.slice(-5).map(a=>`${a.role}: ${a.content}`).join("\n")}

REPLY REQUIREMENTS:
- Response types: ${b.response_types.join(", ")}
- Max length: ${b.max_length} words
- Include personalization: ${b.include_personalization}
- Include CTA: ${b.include_call_to_action}
- Urgency: ${b.urgency_level}

Generate a response that:
1. Addresses the prospect's last message directly
2. Uses the specified sales methodology
3. Maintains the appropriate tone
4. Advances toward the objective
5. Includes relevant personalization

Return a JSON response with:
- primary_response: The main suggested reply
- alternative_responses: 2-3 alternative versions
- personalization_elements: Key personalization used
- call_to_action: Specific CTA if requested
- follow_up_questions: Suggested follow-up questions
- confidence_score: Your confidence in this response (0-1)
- compliance_status: 'approved' if compliant with professional standards
- suggested_timing: Best time to send this message
- channel_optimizations: Platform-specific versions
`}async callLLM(a){return{primary_response:"Thanks for sharing that insight about your Q4 priorities. Given your focus on reducing operational costs, I'd love to show you how companies like yours typically save 20-30% in the first quarter after implementation. Would you be open to a 15-minute call this week to explore how this might apply to your specific situation?",alternative_responses:["I appreciate you mentioning your Q4 cost reduction goals. Based on what you've shared, I think there's a compelling ROI story here. Could we schedule a brief call to walk through a relevant case study?","Your focus on operational efficiency really resonates - it's exactly why similar companies in your industry have seen significant results. Would a quick 15-minute conversation this week work to explore the possibilities?"],personalization_elements:["Q4 priorities","operational costs","industry-specific reference"],call_to_action:"15-minute call this week",follow_up_questions:["What's your timeline for evaluating new solutions?","Who else would be involved in this decision process?","What would success look like in your first quarter?"],confidence_score:.87,compliance_status:"approved",suggested_timing:"Tuesday or Wednesday morning",channel_optimizations:{linkedin:"Shortened version with LinkedIn-friendly formatting",email:"Expanded version with case study attachment offer",whatsapp:"Casual, conversational tone adaptation"}}}parseResponseFromLLM(a,b){return b.compliance_check&&(a.compliance_status=this.checkCompliance(a.primary_response)),a}checkCompliance(a){return["guarantee","promise","definitely","always works","risk-free"].some(b=>a.toLowerCase().includes(b))?"needs_review":"approved"}async analyzeSentiment(a){try{return{content:[{type:"text",text:JSON.stringify({overall_sentiment:"positive",sentiment_score:.72,engagement_indicators:{responsiveness:"high",question_asking:"medium",detail_sharing:"high",objection_level:"low"},buying_signals:["Asked about implementation timeline","Mentioned budget allocation","Requested case studies"],conversation_momentum:"accelerating",next_best_action:"propose_demo",confidence_assessment:{interest_level:"high",decision_authority:"medium",timeline_urgency:"medium"}},null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to analyze sentiment: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async suggestNextSteps(a,b){try{let b={immediate_actions:[{action:"send_case_study",priority:"high",timing:"within_2_hours",rationale:"Prospect explicitly asked for examples"},{action:"schedule_demo",priority:"high",timing:"this_week",rationale:"High engagement and buying signals detected"}],medium_term_actions:[{action:"connect_with_stakeholders",priority:"medium",timing:"next_week",rationale:"Need to identify decision-making unit"}],conversation_strategy:{current_stage:a.conversation_stage,recommended_next_stage:"qualification",key_questions_to_ask:["What's your evaluation process like?","Who else would be involved in this decision?","What would success look like in 90 days?"],potential_obstacles:["Budget approval timing","Stakeholder alignment"],success_probability:.78}};return{content:[{type:"text",text:JSON.stringify(b,null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to suggest next steps: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}async handleObjection(a,b,c){try{let a={objection_analysis:{type:b,severity:"medium",underlying_concern:this.identifyUnderlyingConcern(b),response_strategy:"acknowledge_and_reframe"},suggested_responses:[{approach:"acknowledge_and_understand",response:`I completely understand your concern about ${b}. This is actually something many of our clients initially raised, and I'd love to share how we've addressed similar situations. Can you help me understand what specifically about ${b} is most important to your decision?`},{approach:"provide_evidence",response:`That's a fair point about ${b}. Let me share some relevant data - 85% of our clients had the same initial concern, but after implementation, 94% said it exceeded their expectations. Would it help to speak with a client in a similar situation?`},{approach:"reframe_value",response:`I appreciate you bringing up ${b}. When we look at the total cost of inaction versus the investment, most companies find the ROI compelling. Would it be helpful to walk through a quick ROI analysis specific to your situation?`}],follow_up_actions:["Send relevant case study","Provide ROI calculator","Offer customer reference call"],success_probability:.65};return{content:[{type:"text",text:JSON.stringify(a,null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to handle objection: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}identifyUnderlyingConcern(a){return({price:"ROI and budget allocation",timing:"Resource availability and priorities",authority:"Decision-making process and stakeholders",need:"Problem recognition and urgency",trust:"Vendor credibility and risk mitigation",competition:"Comparative advantage and differentiation"})[a]||"General uncertainty"}async generateFollowupSequence(a,b=3,c=[3,7,14]){try{let d={sequence_id:`followup-${Date.now()}`,total_messages:b,interval_days:c,messages:c.slice(0,b).map((b,c)=>({sequence_number:c+1,send_after_days:b,subject:`Follow-up ${c+1}: ${this.generateSubjectLine(a,c)}`,message:this.generateFollowupMessage(a,c,b),call_to_action:this.generateCTA(c),personalization_notes:["Reference previous conversation points","Include relevant industry insight","Mention specific company challenges discussed"]})),sequence_strategy:{approach:"value_first_nurturing",escalation_path:"increase_urgency_gradually",exit_criteria:"response_received_or_unsubscribe"}};return{content:[{type:"text",text:JSON.stringify(d,null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to generate followup sequence: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}generateSubjectLine(a,b){let c=[`Quick follow-up on our ${a.conversation_stage} discussion`,`Thought you'd find this interesting - ${a.prospect_profile?.company||"your industry"} insights`,`Final follow-up - ${a.objective}`];return c[b]||c[0]}generateFollowupMessage(a,b,c){let d=[`Hi ${a.prospect_profile?.name||"there"}, I wanted to follow up on our conversation about ${a.objective}. I've been thinking about what you mentioned regarding [specific pain point], and I came across something that might be relevant...`,`I hope you're doing well! I saw some interesting industry news about ${a.prospect_profile?.industry||"your sector"} and thought you might find it relevant to our previous discussion...`,`Hi ${a.prospect_profile?.name||"there"}, I don't want to be a pest, but I genuinely believe there's value here for ${a.prospect_profile?.company||"your organization"}. If now isn't the right time, I completely understand...`];return d[b]||d[0]}generateCTA(a){let b=["Would a brief 15-minute call this week work to discuss?","I'd love to get your thoughts - worth a quick conversation?","If there's interest, I'm happy to send over some relevant resources."];return b[a]||b[0]}async optimizeForPlatform(a,b,c){try{let d={linkedin:this.optimizeForLinkedIn(a,c),email:this.optimizeForEmail(a,c),whatsapp:this.optimizeForWhatsApp(a,c),slack:this.optimizeForSlack(a,c),twitter:this.optimizeForTwitter(a,c)},e={original_message:a,platform:b,optimized_message:d[b]||a,optimization_notes:this.getOptimizationNotes(b),character_count:d[b]?.length||a.length,platform_specific_features:this.getPlatformFeatures(b)};return{content:[{type:"text",text:JSON.stringify(e,null,2)}]}}catch(a){return{content:[{type:"text",text:`Failed to optimize for platform: ${a instanceof Error?a.message:"Unknown error"}`}],isError:!0}}}optimizeForLinkedIn(a,b){return a.replace(/\n/g,"\n\n")+"\n\n#SalesStrategy #B2BSales"}optimizeForEmail(a,b){return a+"\n\nBest regards,\nSAM AI Assistant"}optimizeForWhatsApp(a,b){return a.replace(/\./g,".\n").substring(0,200)+" \uD83D\uDC4D"}optimizeForSlack(a,b){return a.replace(/\n/g,"\n> ")}optimizeForTwitter(a,b){return a.substring(0,240)+" #B2BSales"}getOptimizationNotes(a){return({linkedin:["Added line breaks for readability","Added relevant hashtags","Maintained professional tone"],email:["Added professional signature","Email-friendly formatting"],whatsapp:["Shortened for mobile reading","Added emoji for engagement","Casual tone adaptation"],slack:["Optimized for threading","Team communication style"],twitter:["Trimmed to character limit","Added hashtags for discovery"]})[a]||["Standard optimization applied"]}getPlatformFeatures(a){return({linkedin:["Rich text formatting","Hashtag support","Professional network context"],email:["HTML formatting","Attachments","Subject lines","CC/BCC"],whatsapp:["Emoji support","Voice messages","Group messaging"],slack:["Threading","Mentions","Channel context","Integrations"],twitter:["Character limit","Hashtags","Mentions","Public visibility"]})[a]||["Basic text messaging"]}}class h{async initialize(a){try{let b=[];return a.googleSearch&&(this.googleSearchServer=new d.j(a.googleSearch),b.push("Google Search MCP")),a.unipile&&(this.unipileServer=new e(a.unipile),b.push("Unipile MCP")),a.n8n&&(this.n8nServer=new f(a.n8n),b.push("N8N MCP")),a.replyAgent&&(this.replyAgentServer=new g(a.replyAgent),b.push("Reply Agent MCP")),this.isInitialized=!0,{success:!0,message:`MCP Registry initialized with ${b.length} servers`,servers:b}}catch(a){return{success:!1,message:`MCP Registry initialization failed: ${a instanceof Error?a.message:"Unknown error"}`,servers:[]}}}async listAllTools(){let a=[];return this.googleSearchServer&&(await this.googleSearchServer.listTools()).tools.forEach(b=>{a.push({...b,server:"google-search"})}),{tools:a}}async callTool(a){if(!this.isInitialized)return{content:[{type:"text",text:"MCP Registry not initialized"}],isError:!0};let b=a.server||this.detectServerFromTool(a.params.name);return"google-search"!==b?{content:[{type:"text",text:`Unknown server: ${b}. Available servers: ${this.getAvailableServers().join(", ")}`}],isError:!0}:this.googleSearchServer?await this.googleSearchServer.callTool(a):{content:[{type:"text",text:"Google Search MCP server not available"}],isError:!0}}detectServerFromTool(a){return["research_prospect","analyze_company","generate_strategic_insights","check_system_health"].includes(a)?"bright-data":["extract_linkedin_profiles","check_extraction_status","get_extraction_results","estimate_extraction_cost","validate_linkedin_url","list_available_actors"].includes(a)?"apify":["boolean_linkedin_search","company_research_search","icp_prospect_discovery","verify_search_quota"].includes(a)?"google-search":"unknown"}getAvailableServers(){let a=[];return this.googleSearchServer&&a.push("google-search"),a}async getServerStatus(){let a=this.googleSearchServer?(await this.googleSearchServer.listTools()).tools.length:0;return{googleSearch:{available:!!this.googleSearchServer,tools:a},total:{servers:this.getAvailableServers().length,tools:a}}}async researchProspectWithBestSource(a){return a.maxResults,a.budget,{content:[{type:"text",text:"No suitable MCP servers available for prospect research"}],isError:!0}}async generateIntelligenceReport(a,b="meddic"){return{content:[{type:"text",text:"Intelligence report generation not available - Bright Data MCP temporarily disabled"}],isError:!0}}constructor(){this.isInitialized=!1}}let i=new h;function j(){return{googleSearch:process.env.GOOGLE_API_KEY&&process.env.GOOGLE_CSE_ID?{googleApiKey:process.env.GOOGLE_API_KEY,googleCseId:process.env.GOOGLE_CSE_ID,serpApiKey:process.env.SERP_API_KEY,organizationId:process.env.ORGANIZATION_ID||"default-org",userId:process.env.USER_ID||"default-user",maxResults:20,searchTimeout:3e4}:void 0}}}};