(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[769],{4369:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>l});var t=s(5155),a=s(2115),i=s(5040),n=s(63);function o(){let e=(0,n.useRouter)();(0,n.useSearchParams)();let[r,s]=(0,a.useState)("loading"),[o,l]=(0,a.useState)(""),c=(0,i.UU)("https://latxadqrvrrrcvkktrog.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxhdHhhZHFydnJycmN2a2t0cm9nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2OTk5ODYsImV4cCI6MjA2ODI3NTk4Nn0.3WkAgXpk_MyQioVf_SED9O_ArjcT9nH0uy9we2okftE");(0,a.useEffect)(()=>{d()},[]);let d=async()=>{try{let{data:o,error:d}=await c.auth.getSession();if(d){s("error"),l("Authentication failed: "+d.message);return}if(!o.session){let{error:e}=await c.auth.exchangeCodeForSession(window.location.href);if(e){s("error"),l("Failed to complete authentication: "+e.message);return}}let{data:{session:u}}=await c.auth.getSession();if(null==u?void 0:u.user){var r,t,a,i,n;let o=u.user,d=null==(r=o.user_metadata)?void 0:r.organization_id,m=null==(t=o.user_metadata)?void 0:t.organization_name,h=(null==(a=o.user_metadata)?void 0:a.role)||"member",{error:x}=await c.from("users").upsert({id:o.id,email:o.email,first_name:(null==(i=o.user_metadata)?void 0:i.first_name)||"",last_name:(null==(n=o.user_metadata)?void 0:n.last_name)||"",created_at:new Date().toISOString()});if(x&&console.error("Profile creation error:",x),d)try{await c.from("user_organizations").insert({user_id:o.id,organization_id:d,role:h});let{data:r}=await c.from("workspaces").select("*").eq("owner_id",o.id).single();if(!r){let{data:e}=await c.from("workspaces").insert({name:"".concat(m," Workspace"),owner_id:o.id,created_by:o.id,settings:{}}).select().single();r=e}r&&(await c.from("workspace_members").insert({workspace_id:r.id,user_id:o.id,role:"owner"===h?"admin":"member"}),await c.from("users").update({current_workspace_id:r.id}).eq("id",o.id)),s("success"),l("Welcome to ".concat(m,"! Your account has been set up successfully.")),setTimeout(()=>{e.push("/")},3e3)}catch(r){console.error("Organization setup error:",r),s("success"),l("Account created successfully! You can now access the platform."),setTimeout(()=>e.push("/"),3e3)}else s("success"),l("Account verified successfully! You can now access the platform."),setTimeout(()=>e.push("/"),3e3)}else s("error"),l("No user session found. Please try signing in again.")}catch(e){console.error("Callback handling error:",e),s("error"),l("An unexpected error occurred. Please try again.")}};return(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-lg shadow-lg text-center",children:["loading"===r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-6"}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Setting up your account..."}),(0,t.jsx)("p",{className:"text-gray-600",children:"Please wait while we complete your registration."})]}),"success"===r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-green-800 mb-4",children:"\uD83C\uDF89 Welcome to SAM AI!"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:o}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Redirecting you to the platform..."})]}),"error"===r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-red-800 mb-4",children:"Authentication Error"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:o}),(0,t.jsx)("button",{onClick:()=>e.push("/signin"),className:"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700",children:"Try Again"})]})]})})}function l(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600"})}),children:(0,t.jsx)(o,{})})}},5654:(e,r,s)=>{Promise.resolve().then(s.bind(s,4369))}},e=>{e.O(0,[849,441,255,358],()=>e(e.s=5654)),_N_E=e.O()}]);